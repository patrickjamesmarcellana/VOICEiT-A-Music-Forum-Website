<!DOCTYPE html>

<html>
    <head>
        <title>Profile</title>

        <meta charset="UTF-8">
        <link rel="icon" type="image/png" href="images/logo2.png">
        <link rel="stylesheet" type="text/css" media="all" href="css/index.css">
        <link rel="stylesheet" type="text/css" media="all" href="css/profile.css">
        <link rel="stylesheet" type="text/css" media="all" href="css/edit-profile.css">
        <link rel="stylesheet" type="text/css" media="all" href="css/comments.css">

        <!-- profile-specific comment style -->
        <style>
            .comment-container {
                border-radius: 5px;
                margin: 0.2rem auto 1.5rem auto;
                width: 80%;
                background-image: linear-gradient(#31294c, #5756bb, #8182da);
                color: var(--main-color);
                box-shadow: 0px 3px 6px 0px #31294c;
            }

            .profile-user-posts > div {
                overflow: auto;
            }
        </style>
        <script src="js/side_panel_a.js" defer></script>
        <script src="js/navbar.js"></script>
        <script src="js/index.js" defer></script>
        <script src="js/edit-profile.js" defer></script>
        <script src="js/profile.js" defer></script>
        <script src="js/js.cookie-3.0.5.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

        <script src="js/vote_logic.js" type="text/javascript"></script>
        <script src="js/view/comment-view.js" type="text/javascript"></script>
        <script src="js/view/post-view.js" type="text/javascript"></script>
        <script src="js/model/comment-manager.js" type="text/javascript"></script>
        <script src="js/model/post-manager.js" type="text/javascript"></script>
        <script src="js/model/user-manager.js" defer></script>

        <template id="comment-template"> 
            <div class="comment-parent-container comment-container">
                <div class="comment-header">
                    <a class="comment-author"></a>
                    <span class="comment-edited-remark hidden">(edited)</span>
                </div>
                <p class="comment-content"></p>
                <div class="comment-text-editor hidden">
                    <textarea></textarea>
                    <div>
                        <button class="comment-text-editor-cancel-button">Cancel</button>
                        <button class="comment-text-editor-submit-button">Submit</button>
                    </div>
                </div>
                <div class="comment-footer">
                    <button class="comment-upvote-button upvote-sprite"></button>
                    <span class="comment-vote-count"></span>
                    <button class="comment-downvote-button downvote-sprite"></button>
                    <span class="comment-reply-button" >Reply</span>
                    <span class="comment-edit-button hidden" >Edit</span>
                    <span class="comment-delete-button hidden" >Delete</span>
                </div>
                <div class="comment-subcomments-panel comments-panel hidden">
                    <a class="comment-loadmore-button hidden" >Load more comments ($COUNT hidden)</a>
                </div>
            </div>
            
        </template>  
        <script>
            // Reference: https://stackoverflow.com/questions/1696877/how-to-set-a-value-to-a-file-input-in-html/70485949#70485949
            function loadURLToInputFiled(url) {
                getImgURL(url, (imgBlob) => {
                    // Load img blob to input
                    // WIP: UTF8 character error
                    let fileName = url.substring(7)
                    let file = new File([imgBlob], fileName,{type:"image/jpeg", lastModified:new Date().getTime()}, 'utf-8');
                    let container = new DataTransfer(); 
                    container.items.add(file);
                    document.querySelector('#profile-picture').files = container.files;
                })
            }
            // xmlHTTP return blob respond
            function getImgURL(url, callback){
                var xhr = new XMLHttpRequest();
                xhr.onload = function() {
                    callback(xhr.response);
                };
                xhr.open('GET', url);
                xhr.responseType = 'blob';
                xhr.send();
            }

            $(document).ready(async function() {
                const search_params = new URLSearchParams(window.location.search)
                user = await userManager.getUser(search_params.get("user"))
                loadURLToInputFiled(user.photoUrl)
                // $("#profile-picture").val(user.photoUrl)
                $("#description").val(user.description)
            })
        </script>
    </head>

    <body>
        <!-- Navigation Bar -->
        <div class="nav-bar"></div>

        <!-- Content of Webpage -->
        <div class="content" id="home">
            <!-- Topics and Feeds (Leftmost) -->
            <span class="side-panel-a"></span>

            <!-- Posts Panel -->
            <div class="post-panel">
                <div class="profile-panel-2">
                    <div class="profile-picture">
                        <img src="images/melissa_spellman.jpg">
                    </div>

                    <div class="username-and-edit-button-container">
                        <span class="username-text profile-username">melissa_spellman</span>
                        <span>
                            <input type="button" class="edit-profile-button" value="Edit Profile">
                        </span>
                    </div>

                    <div class="user-description">
                        Hi! I'm a neuroscientist student from Johns Hopkins University, and I'm highly invested in how music transcends
                        generations. Currently, my favorite genres of music are classical, jazz, and R&B. Hit me up on my personal email
                        if you'd like to discuss music on your leisure time!

                        Email: melissa_spellman@yahoo.com
                    </div>
                    
                    <div class="user-statistics">
                        <div class="user-last-login">
                            <span class="bold">Last Login</span>
                            <span>June 19, 2023, 2:00 PM</span>
                        </div>
                        <div class="user-register-date">
                            <span class="bold">Member Since</span>
                            <span>January 1, 2023</span>
                        </div>
                    </div>
                </div>

                <div class="view-options-panel">
                    <a class="profile-content-option" id="profile-overview-button">Overview</a>
                    <a class="profile-content-option" id="profile-posts-button">Posts</a>
                    <a class="profile-content-option" id="profile-comments-button">Comments</a>
                </div>

                <div class="profile-user-posts">

                </div>
                <div class="see-more-panel">
                    <a class="see-more-button" href="register.html">See More</a>
                </div>
            </div>

            <!-- Mini Profile Panel (Rightmost) -->
            <div class="side-panel-b">
                <div class="profile-panel">
                    <div class="profile-picture">
                        <img src="images/melissa_spellman.jpg">
                    </div>
                    
                    <div class="username-and-edit-button-container">
                        <span class="username-text profile-username">melissa_spellman</span>
                        <span>
                            <input type="button" class="edit-profile-button" value="Edit Profile">
                        </span>
                    </div>

                    <div class="user-description">
                        Hi! I'm a neuroscientist student from Johns Hopkins University, and I'm highly invested in how music transcends
                        generations. Currently, my favorite genres of music are classical, jazz, and R&B. Hit me up on my personal email
                        if you'd like to discuss music on your leisure time!

                        Email: melissa_spellman@yahoo.com
                    </div>
                    
                    <div class="user-statistics">
                        <div class="user-last-login">
                            <span class="bold">Last Login</span>
                            <span>June 19, 2023, 2:00 PM</span>
                        </div>
                        <div class="user-register-date">
                            <span class="bold">Member Since</span>
                            <span>January 1, 2023</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="edit-profile-modal">
            <div class="modal-content-container">
                <div class="main-header">
                    <span class="header-text">Edit Profile</span>
                    <span class="exit-button"></span>
                </div>
                <div class="main-header-desc">
                    You can customize your profile by uploading a custom profile
                    picture and writing a short description about you.
                </div>
        
                <div class="main-divider">
                    <hr />
                </div>
        
                <div class="user-form">
                    <form method="POST" action="/api/submit/edit-profile?_method=PATCH" id="edit-profile-form">
                        <label for="profile-picture" class="header-font">Profile Picture</label>
                        <div class="profile-picture">
                            <input type="file" name="profile-picture" id="profile-picture" accept="image/png, image/jpeg" />
                        </div>
        
                        <label for="description" class="header-font">Description</label>
                        <div class="description">
                            <textarea name="description" id="description" rows="5"
                                placeholder="Write something about yourself"></textarea>
                        </div>
        
                        <div class="submit-form-button-container">
                            <input type="submit" class="submit-form-button" id="submit-button" value="Save" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </body>
</html>
